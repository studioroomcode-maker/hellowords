# 테니스노트 (Tennis Note) 앱 기획서

> **버전**: 1.0.0
> **최종 수정일**: 2026-02-13
> **플랫폼**: Android / iOS / Web (Expo SDK 54)

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택](#2-기술-스택)
3. [사용자 역할 및 권한 체계](#3-사용자-역할-및-권한-체계)
4. [구독 등급 (Subscription Tier)](#4-구독-등급-subscription-tier)
5. [화면별 기능 상세](#5-화면별-기능-상세)
   - 5.1 [로그인 / 회원가입](#51-로그인--회원가입)
   - 5.2 [홈 (Home)](#52-홈-home)
   - 5.3 [대진 일정 (Match)](#53-대진-일정-match)
   - 5.4 [경기 기록 (Records)](#54-경기-기록-records)
   - 5.5 [선수 관리 (Players)](#55-선수-관리-players)
   - 5.6 [회비 관리 (Dues)](#56-회비-관리-dues)
   - 5.7 [설정 (Settings)](#57-설정-settings)
   - 5.8 [TN 관리 (Super Admin)](#58-tn-관리-super-admin)
6. [대진표 생성 알고리즘](#6-대진표-생성-알고리즘)
7. [AI 기능 (Gemini 연동)](#7-ai-기능-gemini-연동)
8. [데이터 아키텍처](#8-데이터-아키텍처)
9. [오프라인 / 동기화 전략](#9-오프라인--동기화-전략)

---

## 1. 프로젝트 개요

### 1.1 앱 소개

**테니스노트**는 테니스 동호회의 운영을 통합 관리하는 올인원 앱입니다.
대진표 자동 생성, 실시간 점수 입력, 통계/랭킹 분석, 회비 관리, 코트 예약까지
동호회 운영에 필요한 모든 기능을 하나의 앱에서 제공합니다.

### 1.2 핵심 가치

| 가치 | 설명 |
|------|------|
| **공정한 대진** | 게임 수 균등, 파트너/상대 다양성을 보장하는 알고리즘 |
| **실시간 기록** | 경기 직후 즉시 점수 입력 및 통계 반영 |
| **AI 분석** | Gemini AI 기반 경기 분석, 선수 프로파일, 사진 점수 인식 |
| **유연한 권한** | 슈퍼관리자 → 관리자(3단계) → 회원 세분화된 권한 체계 |
| **오프라인 우선** | 인터넷 없이도 모든 기능 사용 가능, 이후 자동 동기화 |

### 1.3 대상 사용자

- 테니스 동호회 운영자 (관리자)
- 동호회 회원 (일반 사용자)
- 다수의 클럽을 관리하는 총괄 관리자 (슈퍼 관리자)

---

## 2. 기술 스택

| 영역 | 기술 |
|------|------|
| **프레임워크** | React Native (Expo SDK 54) + TypeScript |
| **상태관리** | Zustand (authStore, clubStore, matchStore, playerStore) |
| **백엔드** | Supabase (Auth + Database + Storage) |
| **로컬 저장** | AsyncStorage (오프라인 우선 캐시) |
| **라우팅** | expo-router (파일 기반 라우팅) |
| **AI** | Google Gemini 2.0 Flash API |
| **인증** | Supabase Auth (이메일/비밀번호 + Google OAuth PKCE) |
| **UI** | 커스텀 디자인 시스템 (다크 테마, design tokens) |

---

## 3. 사용자 역할 및 권한 체계

### 3.1 역할 계층

```
슈퍼 관리자 (Super Admin)
  └─ 전체 클럽 관리, 구독 등급 설정, 기능 플래그 제어
       │
클럽 관리자 (Admin) - 3단계 세분화
  ├─ Level 1 (최고관리자): 모든 권한
  ├─ Level 2 (관리자): 회비 접근 제외 전체 권한
  └─ Level 3 (보조): 점수 입력만 가능
       │
일반 회원 (Member)
  └─ 관리자가 설정한 범위 내에서 열람/입력
```

### 3.2 관리자 권한 매트릭스

| 권한 | Level 1 | Level 2 | Level 3 |
|------|---------|---------|---------|
| 회비 관리 접근 | O | X | X |
| 선수 정보 편집 | O | O | X |
| 대진표 생성 | O | O | X |
| 점수 입력 | O | O | O |

### 3.3 회원 제한 설정 (관리자 설정)

관리자는 일반 회원에게 다음 항목을 선택적으로 숨길 수 있습니다:

- **탭 단위**: 대진 일정, 경기 기록, 선수 관리, 회비, 설정
- **세부 항목**:
  - 홈: 공지사항, 입금정보, 운세, 최근 대진표
  - 대진: 일정 보기, 대진표 생성, 일정 등록
  - 기록: 날짜별, 월간, 개인별, 랭킹 (각각의 하위 항목 포함)
  - 선수: 성별, 조, 연령, 주손, 라켓, NTRP, 전화, MBTI
  - 회비: 납부, 현황, 정산

---

## 4. 구독 등급 (Subscription Tier)

| 기능 | Basic | Plus | Pro | Prime |
|------|-------|------|-----|-------|
| **대진표 생성** | O | O | O | O |
| **고급 대진 모드** (한울AA, 수동) | X | X | O | O |
| **JPG 캡처** | X | O | O | O |
| **예상 승률 표시** | X | X | O | O |
| **기록 보기** | X | O | O | O |
| **점수 편집** | X | X | O | O |
| **하이라이트/MVP** | X | X | O | O |
| **AI 분석** | X | X | X | O |
| **월간 통계** | X | X | O | O |
| **개인별 통계** | X | X | X | O |
| **랭킹** | X | X | O | O |
| **선수 관리** | O | O | O | O |
| **설정** | O | O | O | O |
| **회비 관리** | X | X | O | O |
| **코트 예약** | X | X | O | O |

슈퍼 관리자는 클럽별로 등급과 무관하게 개별 기능 플래그를 오버라이드할 수 있습니다.

---

## 5. 화면별 기능 상세

---

### 5.1 로그인 / 회원가입

#### 기존 회원 로그인
- 이메일 입력 → 등록된 클럽 자동 검색
- 비밀번호 로그인 (Supabase Auth)
- Google OAuth 소셜 로그인 (PKCE flow, Android 딥링크 지원)

#### 신규 회원 가입
1. 클럽 코드 입력 (예: "HMMC")
2. 이름, 닉네임, 전화번호 입력
3. 기존 미연결 선수 프로필이 있으면 자동 연결
4. 없으면 새 선수 레코드 생성 후 자동 로그인

#### 슈퍼 관리자 플로우
- 슈퍼 관리자 이메일은 클럽 선택 없이 전체 접근 가능

---

### 5.2 홈 (Home)

홈 화면은 동호회의 **대시보드** 역할을 합니다.

#### 5.2.1 인사 헤더
- "안녕하세요, {이름}님" + 오늘 날짜 + 클럽명
- 나의 승률 / 경기수 / 출석일수 요약 바

#### 5.2.2 나의 경기 통계 카드
- **주요 지표 (3열)**: 승률(%), 총 경기수, 승수
- **보조 지표 (5열)**: 패, 무, MVP, 점수, 평균득점
- 터치 시 개인 통계 화면으로 이동

#### 5.2.3 공지사항
- 관리자가 작성한 공지 텍스트 표시
- 관리자: 탭하여 인라인 편집 가능
- 회원 제한 설정으로 숨김 가능

#### 5.2.4 회비 납부 알림
- 미납/확인요망/입금완료 상태별 UI
- **미납**: 계좌이체 버튼 (계좌 복사 + SMS 발송), 카카오페이 버튼
- **확인요망**: 입금대기 배지 + 확인요청 SMS 발송
- **입금완료**: 초록 체크 배지 + 지우기 버튼

#### 5.2.5 오늘의 테니스 운세
- 60개 이상의 유머러스한 테니스 운세 메시지
- 시드 기반 난수: 같은 유저 + 같은 날 = 같은 운세
- 동적 플레이스홀더 (라켓 브랜드, 프로 선수명, 연령대 등)

#### 5.2.6 대진 분석 (AI)
- **전체 분석**: 당일 대진의 코트 역학, 매칭 균형 분석
- **개인 분석**: 상대 전적 기반 위협도 분류
  - 천적(25% 이하), 약점(25-40%), 강적(60-75%), 지배적(75%+), 팽팽(40-60%)
  - 파트너 궁합: 드림팀(70%+), 안 맞음(30%-)
  - 난이도/흥미도 점수 + 예측 전적
- Gemini AI 확장 분석 (활성화 시 "AI" 배지 표시)

#### 5.2.7 최근 대진표
- 가장 최근 세션 날짜 + 완료율(%)
- 매치 테이블: 팀1(선수명 배지) / 점수 / 팀2
- 승률 예측 표시 (설정 시)
- 라운드별/조별 구분
- 선수명 터치 → 개인 통계 이동
- 차트 아이콘 → 상대 전적 모달

#### 5.2.8 오늘의 활동 (준비 중)
- 소모 칼로리, 걸음 수, 운동 시간
- 스마트워치 연동 예정

---

### 5.3 대진 일정 (Match)

2개의 서브탭으로 구성: **일정 보기** / **대진표 생성**

#### 5.3.1 일정 보기 (코트 예약 달력)

##### 달력
- 월별 네비게이션 (이전/다음 월)
- 공휴일 시스템: 양력(신정, 삼일절 등) + 음력(설, 추석, 부처님오신날)
- 대체공휴일 자동 표시
- 토요일(파란색), 일/공휴일(빨간색) 표시
- 기념일/특별한 날 등록 (관리자)

##### 코트 예약 카드
각 날짜에 등록된 코트 예약 정보 표시:
- 시간, 장소, 코트명
- 대상 성별 배지 (♂/♀/남녀/무관) + 인원 제한
- NTRP 범위 (최소-최대)
- 참가비 정보
- 모집 마감/재개 상태
- 참가자 목록 + 참가/불참 토글
- 메모 필드
- 1시간 전 알림 설정

##### 텍스트 복사
- 월간 코트 일정을 텍스트로 생성하여 클립보드 복사
- 형식: `🎾 [클럽명] N월 코트 일정`

#### 5.3.2 대진표 생성

##### A. 선수 선택
- 전체 선수 그리드 (칩 토글 방식)
- 성별 색상 구분 (남=파란, 여=핑크)
- 전체 선택 / 선택 해제
- **게스트 추가**: 이름, 성별, 조, NTRP 입력 (길게 눌러 제거)

##### B. 선수 순서
- **랜덤 모드**: 셔플 버튼으로 순서 무작위화
- **수동 모드**: 위/아래 화살표로 순서 직접 조정
- **보기 모드**: 전체 / 조별
- 조별 뷰에서 각 조 내 독립적 순서 관리

##### C. 대진 설정

| 항목 | 옵션 |
|------|------|
| **게임 유형** | 복식, 단식, 팀전, 팀전단식 |
| **생성 방식** | 자동 생성, 직접 배정(수동) |
| **복식 모드** | 혼합복식, 동성복식, 랜덤복식, 한울AA, 수동대진 |
| **단식 모드** | 랜덤단식, 동성단식, 혼합단식 |
| **게임 수 기준** | 총라운드(2-20) / 인당게임(2-10) / 총게임수(1-32) |
| **코트 수** | 1-5 |
| **NTRP 균형** | 활성/비활성 |
| **같은 조만 대진** | 활성/비활성 |
| **스페셜 매치** | 교류전 (통계 미반영) 체크박스 |

##### D. 팀 모드 (팀전 선택 시)
- 2~4팀 설정
- 팀별: 팀명 편집, 색상 선택 (10색), 선수 배정 칩

##### E. 수동 배정 모드
- 라운드×코트 매트릭스로 슬롯 표시
- 슬롯별 드롭다운으로 선수 직접 선택
- 성별 모드: 성별랜덤 / 동성 / 혼합 (하위 옵션 포함)
- **자동 채우기**: 전체/체크만, 빈 슬롯을 AI가 공정하게 채움
- **초기화**: 전체/체크만, 선택 슬롯 비우기
- 조별 모드 시 조 단위 독립 관리

##### F. 생성된 대진표
- 라운드/조별 구분 표시
- 매치별: 게임번호, 코트, 팀1 vs 팀2, 승률 예측
- 선수명 터치 → 전적 모달
- 게임당 삭제 버튼 (X)
- **인당 게임수 요약**: "2게임: [선수A, 선수B]" 형태

##### G. 기존 세션 처리
- 해당 날짜에 세션이 이미 있을 때:
  - "기존에 추가" (병합)
  - "덮어쓰기" (대체)
  - "취소" (새 대진 폐기)

##### H. 저장 및 내보내기
- **저장**: Firebase/Supabase에 세션 저장
- **JPG 저장**: 대진표를 이미지로 캡처 (워터마크: 날짜+클럽명)
- **텍스트 복사**: 라운드별 텍스트 형식 클립보드 복사

---

### 5.4 경기 기록 (Records)

4개의 서브탭: **날짜별** / **월간** / **개인별** / **랭킹**

#### 5.4.1 날짜별 탭

##### 날짜 네비게이션
- 달력 피커 모달 (세션이 있는 날 강조)
- 이전/다음 세션 화살표
- "최신 세션으로" 바로가기

##### 오늘의 하이라이트
- 출석 인원 + 총 게임 수
- **오늘의 MVP**: 최다 승점 선수 (승/무/패, 득실차)
- **무패 선수**: 전패 없이 마친 선수 목록
- **제빵왕**: 셧아웃(0점) 승리 최다 선수

##### 경기 총평
- 오프라인 자동 분석 + AI 확장 분석 (Gemini)
- SBS 스포츠 뉴스 스타일 해설

##### 점수 입력 (2가지 뷰)

**대진별 보기**:
- 코트/라운드별 카드
- 팀1 선수명(성별 배지) / 점수 드롭다운(0-10) / 팀2 선수명
- 승률 예측(%) 좌우 표시
- 코트 잠금 아이콘 (실수 방지)
- 사이드 토글 (포(듀스) / 백(애드))
- 퀵 전적 버튼 (차트 아이콘)

**개인별 보기**:
- 선수별 성적표 형식
- 승/무/패/득실 기준 개인 순위
- 게임별 개별 점수

##### AI 사진 점수 인식
- 카메라/갤러리에서 점수판 사진 촬영
- Gemini Vision API로 4가지 형식 자동 인식:
  - A: 단순 "매치 vs 점수" 행
  - B: 선수×라운드 격자 (X:Y)
  - C: 리그 테이블 (교차 매트릭스)
  - D: 필기/화이트보드
- 신뢰도 표시: 높음/중간/낮음
- 확인 모달 → 일괄 적용

##### 게임 관리 (관리자)
- **선수 교체**: 전체 일괄 교체 / 개별 게임 교체
- **게임 순서 변경**: 두 게임 위치 스왑 (코트 보존)
- **게임 삭제**: 확인 후 삭제 + 결과 키 재인덱싱
- **세션 삭제**: 전체 세션 삭제 (확인 필수)

##### 빈 점수표
- 선수명 포함/미포함 옵션
- 인쇄용 빈 점수표 생성 (JPG 저장 가능)

#### 5.4.2 월간 탭

##### 월 선택
- 최근 6개월 드롭다운

##### 선수별 BEST 시상
| 시상 | 기준 |
|------|------|
| MVP | 최다 승점 + 출석 + 득실차 |
| 격차왕 | 최고 평균 득실차 |
| 평화주의자 | 최다 무승부 |
| 우정왕 | 최다 다양한 파트너 |
| 출석왕 | 최다 출석일 |
| 연승왕 | 최장 연속 승리 |
| 제빵왕 | 최다 셧아웃 승리 |

##### 월간 리더보드
- 승점 기준 (승=3점, 무=1점, 패=0점)
- 열: 순위, 이름, 승점, 출석일, 경기수, 승/패/무, 승률
- 전체 / 조별 필터 전환
- 선수명 터치 → 개인별 탭 이동

##### 카테고리별 BEST
| 카테고리 | 내용 |
|----------|------|
| 주손별 | 오른손 vs 왼손 승률 비교 |
| 라켓별 | 브랜드별 승률 |
| 연령대별 | 20대~60대+ 승률 |
| 성별별 | 남 vs 여 승률 |
| MBTI별 | 16가지 유형별 승률 |

##### 월간 경기 결과
- 날짜별 그룹핑 + 요일 표시
- 라운드 구분선
- 매치별: 게임번호, 코트, 팀1/2 선수, 점수(승패 색상)

#### 5.4.3 개인별 탭

##### 선수 선택
- 드롭다운 (전체 or 본인만 - 회원 제한 설정에 따라)
- 기간: 전체 / 월간

##### AI 동물 프로필 카드
- Gemini AI가 선수 데이터 기반으로 동물 프로필 생성
- 내셔널 지오그래픽 다큐멘터리 내레이션 스타일
- 이모지 + 동물명 + 칭호 + 6-8문장 설명
- 오프라인 폴백 (API 비활성 시 템플릿 사용)
- 선수 성적 변동 시 자동 갱신

##### 개인 통계 카드
- **주요**: 경기수, 승, 무, 패, 승률(%)
- **보조 (확장)**: 득실차, MVP 횟수, 총 득점/실점, 평균 득점/실점, 출석일

##### 차트
- **승/무/패 분포**: 가로 스택 바 차트 (%, 범례)
- **월별 승률 추이** (전체 기간 시): 6개월 라인 차트 (50% 기준선)

##### 매치업 하이라이트
| 항목 | 설명 |
|------|------|
| 천생연분 (💍) | 최고 승률 파트너 |
| 라이벌 (⚖️) | ~50% 승률 상대 |
| 천적 (🧨) | 최저 승률 상대 |

##### 상대별/파트너별 테이블
- 정렬 가능 열: 이름, 경기수, 승/무/패, 승률
- 승률 색상: 녹색(50%+), 빨간(50%-)

##### 상대 속성별 분석 차트
| 차트 | 설명 |
|------|------|
| 코트 사이드별 | 듀스(포) vs 애드(백) 승률 비교 |
| 성별별 | 남성/여성 상대 승률 |
| 주손별 | 오른손/왼손 상대 승률 |
| NTRP별 | NTRP 레벨별 승률 라인 차트 |
| MBTI별 | 16유형별 승률 수직 바 차트 |

#### 5.4.4 랭킹 탭

##### 기간 선택
- **월간**: 월 선택 드롭다운 + 전월 대비 순위 변동 표시
- **전체**: 클럽 생성 이후 전체 기간

##### 랭킹 기준 (6가지, 가로 스크롤 탭)
| 기준 | 정렬 | 표시 |
|------|------|------|
| 승점 | 승점 내림차순 (동률 시 승률) | N점 |
| 승률 | 승률 내림차순 (동률 시 경기수) | N% |
| 총득점 | 득점 내림차순 | N점 |
| 평균득점 | 게임당 평균 내림차순 | N.N점 |
| 출석일수 | 출석 내림차순 | N일 |
| 득실차 | (득점-실점) 내림차순 | +N / -N |

##### 포디움 (Top 3)
- 3열 레이아웃: #2 (좌) / #1 (중앙, 크게) / #3 (우)
- #1: 80x80 아바타, 프라이머리 보더, 글로우, 🏆 트로피
- #2/#3: 64x64 아바타
- 프로필 사진 또는 이니셜 원형 아바타

##### 내 현재 순위 카드
- 순위 #N / 승점 / 승률 3칸 표시

##### 리더보드
- 순위 번호 + 아바타(사진/이니셜) + 이름 + 전적(N승-N패) + 기준값
- **나의 행 하이라이트**: "나" 배지 + 확장 미니 스탯
  - 승률(프로그레스바), 경기수(승/무/패), 득실차(+/-)
- **순위 변동 표시** (월간): ▲ 녹색 / ▼ 빨간 / - 회색
- 전체 / 조별 필터

---

### 5.5 선수 관리 (Players)

#### 5.5.1 표시 모드
- **전체**: 전체 선수 목록
- **조별구분**: 조(A조, B조, 미배정 등)별 분류

#### 5.5.2 선수 데이터 필드

| 필드 | 타입 | 비고 |
|------|------|------|
| 이름 | 텍스트 | 생성 후 변경 불가 |
| 닉네임 | 텍스트 | 선택사항 |
| 이메일 | 텍스트 | 계정 연결용 |
| 성별 | 남/여 | 필수 |
| 연령대 | 20대~60대+, 비밀 | |
| 주손 | 오른손/왼손 | |
| 라켓 | 브랜드 선택 | 윌슨, 바볼랏, 헤드, 요넥스 등 |
| NTRP | 1.0~7.0 | 선택사항 |
| 관리자 NTRP | 1.0~7.0 | 관리자만 설정 가능 |
| MBTI | 16유형 | |
| 전화번호 | 텍스트 | 관리자만 열람 |
| 조 | A조, B조, 미배정 등 | |
| 프로필 사진 | URL | Supabase Storage |

#### 5.5.3 기능
- **검색**: 이름/닉네임 검색
- **통계 요약 바**: 전체, 남/여, 조별 인원
- **파이 차트 모달**: 성별, 연령대, 주손, NTRP, 라켓, 조 분포
- **CRUD**: 추가(모달), 편집(관리자), 삭제(관리자, 확인 필요)
- **회원 모드**: 선수 터치 → 개인 통계 화면으로 이동
- **회원 제한**: 조, NTRP 등 특정 필드 숨김 가능

---

### 5.6 회비 관리 (Dues)

3개의 서브탭: **회비납부** / **납부현황** / **회비정산**

#### 5.6.1 회비납부 탭

##### 청구 기간 관리
- 기간명, 기본 금액, 날짜 설정
- 청구 대상 회원 선택
- **등급별 차등 요금**:
  - 관리자 레벨별 비율 할인 또는 면제
  - 개인별 커스텀 금액 오버라이드
- 장부 카테고리 연동 (자동 기입)
- 편집/삭제

##### 예약 청구
- 미래 날짜/시간 설정 → 자동 활성화
- 예약 내역 관리

##### SMS 연동
- 미납 회원에게 납부 요청 SMS 발송
- SMS 본문 커스터마이즈
- 복수 관리자 전화번호 지원
- 입금 확인 SMS 수신

##### 결제 수단
- **계좌이체**: 계좌 정보 자동 복사 + SMS 발송
- **카카오페이**: 설정된 카카오페이 링크로 이동

#### 5.6.2 납부현황 탭
- 청구 기간별 필터 (회비/기타/전체)
- 연/월 필터
- **진행률 바**: 납부 완료 비율
- **상태 요약 카드**: 완료/대기/미납 건수 및 금액
- **미납자 목록**: 이름, 금액, 상태

#### 5.6.3 회비정산 (장부) 탭

##### 수입/지출 관리
- 항목: 날짜, 설명, 유형(수입/지출), 금액, 카테고리, 메모
- **기본 카테고리**: 회비, 코트비, 식비, 용품구매, 대회비, 기타수입, 기타지출
- **커스텀 카테고리**: 사용자 정의 카테고리 추가
- 월/연도 필터 + 카테고리 필터

##### 정산 요약
- 총 수입, 총 지출, 잔액
- 필터된 기간의 소계
- 누적 잔액 계산

---

### 5.7 설정 (Settings)

#### 5.7.1 프로필 관리
- 아바타 이미지 업로드 (Supabase Storage)
- 이름, 닉네임, 성별, 연령, 주손, NTRP, MBTI, 라켓, 전화번호 편집

#### 5.7.2 클럽 정보 (관리자)
- 클럽명, 클럽 코드 인라인 편집
- 역할 배지 표시
- 클럽 전환 (멀티클럽)

#### 5.7.3 표시 설정 (관리자)
- **이름 표시 모드**: 이름 / 닉네임
- **조 설정**: 활성/비활성, 조 추가/삭제/이름변경, 회원에게 숨김
- **NTRP 설정**: 회원 숨김, 균형 기본값, 관리자 NTRP 우선
- **승률 예측**: 표시/숨김, JPG 포함 여부

#### 5.7.4 기본값 설정 (관리자)
- 기본 코트 수 (1-10)
- 기본 인당 게임 수 (1-20)
- 기본 게임 유형 (단식/복식)
- 기본 복식 모드
- 기본 생성 방식 (자동/수동)

#### 5.7.5 대진 모드 표시 (관리자)
- 한울AA, 혼합복식, 동성복식, 랜덤복식, 수동대진, 단식 각각 표시/숨김

#### 5.7.6 회원 제한 (관리자)
- 계층적 트리 구조로 탭별/세부 항목별 토글

#### 5.7.7 회원 관리 (관리자)
- 회원 이메일 추가/삭제
- 이메일 ↔ 선수 프로필 연결 모달
- 회원 삭제 시 선수 프로필 연쇄 삭제 옵션

#### 5.7.8 관리자 관리 (관리자)
- 관리자 이메일 추가/삭제 (최소 1명 유지)
- 관리자 레벨(1/2/3) 배정
- 레벨명 커스터마이즈

#### 5.7.9 계좌 설정 (관리자)
- 은행명, 계좌번호, 예금주
- 카카오페이 URL
- 회비 확인 연락처 (복수)

#### 5.7.10 AI 설정
- Gemini API 키 입력 및 테스트
- AI 분석 활성/비활성

#### 5.7.11 데이터 백업/복원
- **내보내기**: 세션, 선수, 회비 데이터를 JSON 파일로 다운로드
- **가져오기**: JSON 파일에서 데이터 복원
- 각 데이터 유형별 독립 내보내기/가져오기

#### 5.7.12 계정
- 로그아웃
- 클럽 변경

---

### 5.8 TN 관리 (Super Admin)

슈퍼 관리자 전용 화면입니다.

#### 5.8.1 시스템 개요
- 전체 클럽 수, 총 선수 수, 총 세션 수

#### 5.8.2 구독 등급 매트릭스
- Basic / Plus / Pro / Prime 4단계
- 16개 기능 플래그 × 4단계 = 토글 매트릭스 그리드
- 실시간 편집 및 저장

#### 5.8.3 클럽별 관리
- 확장 가능한 카드 (클럽당)
- **등급 배정**: Basic/Plus/Pro/Prime 퀵 토글
- **요약**: 회원수, 세션수, 최근 세션 날짜
- **클럽 정보 편집**: 코드, 이름, 관리자 이메일 목록
- **기능 플래그 오버라이드**: 등급과 무관한 개별 기능 제어
- **설정 오버라이드**: 기본 코트수, 기본 게임수, NTRP 설정
- **클럽 삭제**: 모든 관련 데이터 연쇄 삭제

#### 5.8.4 클럽 등록/삭제
- 새 클럽 등록 (코드, 이름, 초기 관리자)
- 중복 코드 검증

#### 5.8.5 슈퍼 관리자 관리
- 슈퍼 관리자 이메일 추가/삭제 (최소 1명)

#### 5.8.6 뷰 전환
- "관리자로 보기" / "회원으로 보기" 토글 (테스트용)

---

## 6. 대진표 생성 알고리즘

### 6.1 자동 대진 (복식)

**목표**: 모든 선수가 공정하게 게임하고, 다양한 파트너/상대와 경기

**스코어링 시스템** (낮을수록 좋은 매칭):

| 요소 | 가중치 | 설명 |
|------|--------|------|
| 파트너 반복 | 30 × (횟수²) | 같은 파트너 반복 페널티 (제곱) |
| 최근 파트너 | 60 | 직전 라운드 같은 파트너 강한 페널티 |
| 상대 반복 | 12 × (횟수²) | 같은 상대 반복 페널티 (제곱) |
| 최근 상대 | 22 | 직전 라운드 같은 상대 페널티 |
| 게임수 공정 | 16 × (편차) | 최대 1게임 차이 강제 |
| 연속 라운드 | 120 | 연속 출전 최대 페널티 |
| 1라운드 간격 | 45 | 한 라운드 쉬고 출전 페널티 |
| 페이스 | 18 | 앞/뒤에 게임 몰림 방지 |
| NTRP 균형 | 6 | 팀 평균 NTRP 차이 (선택사항) |

**혼합복식 특별 가중치**:
- 파트너 반복: 200 (훨씬 강한 페널티)
- 성별 강제: 팀당 반드시 남1+여1

### 6.2 한울 AA 방식

- 5~16명 전용 사전 정의 패턴
- 정확히 4게임/인 보장
- 시드 슬롯 순서로 실력 기반 배치
- 2코트, 4라운드 고정

### 6.3 자동 대진 (단식)

| 요소 | 가중치 | 비고 |
|------|--------|------|
| 게임수 공정 | 50 | 최우선 |
| 상대 반복 | 30 × (횟수²) | |
| 연속 라운드 | 60 | |
| 1라운드 간격 | 20 | |
| NTRP 균형 | 5 | 선택사항 |

### 6.4 수동 대진 자동 채우기

- **하드 블록**: 게임수 차이 > 1 → 99999점 (절대 불가)
- **라운드 분포**: 연속 출전 80, 1간격 30 페널티
- **페이스 컨트롤**: 기대 진행률 대비 편차
- **파트너/상대 다양성**: 반복 페널티
- **NTRP 균형**: 활성화 시 고려
- **성별 필터**: 동성/혼합/특정 성별 강제

### 6.5 팀 대진

- 팀간 로테이션 매칭
- 팀 내 최소 게임수 선수 우선 배정
- 팀 내 공정성 보장

---

## 7. AI 기능 (Gemini 연동)

**모델**: Google Gemini 2.0 Flash

### 7.1 동물 프로필 생성

| 항목 | 내용 |
|------|------|
| **입력** | 승률, 경기수, 승/무/패, 득실, 연승/연패, 최근 폼, 베스트 파트너/천적, 출석, MVP |
| **출력** | 이모지 + 동물명 + 칭호(8자) + 설명(6-8문장) |
| **스타일** | 내셔널 지오그래픽 다큐 내레이션 |
| **캐싱** | 선수별 성적 해시 기반, 변동 시 갱신 |

### 7.2 대진 분석 (경기 전)

| 항목 | 내용 |
|------|------|
| **입력** | 총 매치수, 총 선수, NTRP 균형, 주목 매칭(천적/드림팀/첫만남 등) |
| **출력** | 영화 스타일 제목(15자) + 분석(6-8문장) |
| **스타일** | UFC/넷플릭스 스포츠 다큐 |

### 7.3 경기 결과 분석 (경기 후)

| 항목 | 내용 |
|------|------|
| **입력** | MVP, 무패 선수, 접전 게임, 최다 점수차 게임 |
| **출력** | 제목 + 총평 |
| **스타일** | SBS 스포츠 뉴스 클로징 |

### 7.4 개인 매치 분석

| 항목 | 내용 |
|------|------|
| **입력** | 선수명, 각 매치별 상대/파트너 전적 |
| **출력** | 매치별 전술 코칭 조언 |
| **스타일** | 코너 코치 경기 전 작전 브리핑 |

### 7.5 사진 점수 인식

| 항목 | 내용 |
|------|------|
| **입력** | 점수판 사진 (Base64) + 매치 컨텍스트(팀 라인업) |
| **인식 형식** | 단순행, 격자, 교차매트릭스, 필기 |
| **출력** | 매치별 점수 + 신뢰도(high/medium/low) |

---

## 8. 데이터 아키텍처

### 8.1 저장 구조

```
AsyncStorage (로컬)
├── @tennis_sessions_{clubCode}      세션 데이터
├── @tennis_players_{clubCode}       선수 목록
├── @tennis_settings_{clubCode}      클럽 설정
├── @tennis_admin_levels_{clubCode}  관리자 레벨
├── @tennis_members_{clubCode}       회원 이메일
├── @tennis_dues_{clubCode}          회비 데이터
├── @tennis_ledger_{clubCode}        장부 데이터
├── @tennis_reservations_{clubCode}  코트 예약
├── @tennis_club_tier_{clubCode}     구독 등급
├── @tennis_super_admins             슈퍼 관리자 목록
├── @tennis_tier_feature_config      등급별 기능 설정
└── @tennis_clubs_registry           클럽 레지스트리
```

### 8.2 핵심 데이터 모델

```
Player (선수)
├── name, nickname, email, gender, hand
├── ageGroup, racket, group, mbti
├── ntrp, adminNtrp, phone, photoURL
└── createdAt

Session (세션)
├── schedule: Match[]           매치 배열
├── results: Record<1..N>       결과 (1-based 키)
├── courtType, specialMatch
├── groupsSnapshot, groupOnly
└── createdAt, updatedAt

Match (매치)
├── gameType: 복식/단식/삭제
├── team1: string[], team2: string[]
└── court: number

MatchResult (결과)
├── t1: number, t2: number     팀1/팀2 점수
└── sides: Record<선수, 포/백>  사이드 위치

DuesData (회비)
├── billingPeriods[]            청구 기간
├── payments: Record<기간, PaymentRecord[]>
└── scheduledBillings[]         예약 청구

LedgerEntry (장부)
├── date, description, type(수입/지출)
├── amount, category, memo
└── billingPeriodId, playerName
```

---

## 9. 오프라인 / 동기화 전략

### 9.1 Local-First 아키텍처

```
사용자 액션
    ↓
Zustand Store (상태 업데이트)
    ↓
AsyncStorage (즉시 로컬 저장) → UI 즉시 반영
    ↓
SyncManager (백그라운드 큐)
    ↓ (온라인 시)
Supabase (서버 동기화)
```

### 9.2 동기화 큐

| 큐 | 설명 |
|----|------|
| pushPlayer | 선수 추가 |
| pushPlayerUpdate | 선수 수정 |
| pushPlayerDelete | 선수 삭제 |
| pushSession | 세션 저장 |
| pushSessionDelete | 세션 삭제 |
| pushDues | 회비 변경 |
| pushSettings | 설정 변경 |

### 9.3 전체 동기화

- 클럽 로드 시 `fullSync(clubCode)` 실행
- 로컬 큐에 쌓인 모든 변경사항 서버 반영
- 서버의 최신 데이터로 로컬 캐시 갱신

### 9.4 크로스탭 동기화

- `sessionVersion` 카운터로 다른 탭의 변경 감지
- 세션 저장 시 버전 증가 → 다른 탭에서 자동 리로드

---

> **문서 끝**
