<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#0a0a0a">
<title>Hello Words</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700&family=Noto+Sans+KR:wght@700;900&family=Noto+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0a;
  --surface: #141414;
  --border: #252525;
  --accent: #e8ff47;
  --text: #f0f0e8;
  --sub: #666660;
  --card: #1a1a1a;
  --c600: #4CAF7D;
  --c700: #4A9EFF;
  --c800: #FF7043;
}
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; min-height: 100vh; }

header {
  position: sticky; top: 0; z-index: 50;
  background: rgba(10,10,10,.92);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 14px 20px;
  display: flex; align-items: center; gap: 14px;
}
.back-btn {
  display: flex; align-items: center; gap: 6px;
  color: var(--sub); font-size: 14px;
  cursor: pointer; text-decoration: none;
  transition: color .2s; flex-shrink: 0;
}
.back-btn:hover { color: var(--text); }
.brand {
  font-family: 'Instrument Serif', serif;
  font-style: italic; font-size: 20px; color: var(--accent);
}
.nav-btns { margin-left: auto; display: flex; gap: 8px; }
.nav-btn {
  width: 34px; height: 34px; border-radius: 8px;
  border: 1px solid var(--border); background: var(--surface);
  color: var(--text); font-size: 16px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all .15s; text-decoration: none;
}
.nav-btn:hover { border-color: #3a3a3a; background: #222; }
.nav-btn:disabled { opacity: .3; cursor: default; }

.content { padding: 24px 20px 100px; max-width: 600px; margin: 0 auto; }

.level-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 12px; border-radius: 20px;
  font-size: 12px; font-weight: 600; letter-spacing: .5px; margin-bottom: 16px;
}
.badge-600 { background: rgba(76,175,125,.15); color: var(--c600); border: 1px solid rgba(76,175,125,.3); }
.badge-700 { background: rgba(74,158,255,.15); color: var(--c700); border: 1px solid rgba(74,158,255,.3); }
.badge-800 { background: rgba(255,112,67,.15); color: var(--c800); border: 1px solid rgba(255,112,67,.3); }

.word-card {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 20px; padding: 28px 24px; margin-bottom: 16px;
}
.word-main {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 52px; font-weight: 900; line-height: 1;
  color: var(--text); margin-bottom: 8px; letter-spacing: -0.5px;
}
.phonetic {
  font-size: 15px; color: var(--sub);
  font-family: 'Noto Sans', 'Segoe UI', 'Arial Unicode MS', sans-serif;
  margin-bottom: 16px; letter-spacing: 0.3px;
}
.tts-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 16px; border-radius: 10px;
  border: 1px solid var(--border); background: var(--surface);
  color: var(--sub); font-size: 13px; cursor: pointer;
  transition: all .2s; margin-bottom: 20px; font-family: 'DM Sans', sans-serif;
}
.tts-btn:hover { border-color: var(--accent); color: var(--accent); }
.tts-btn.playing { border-color: var(--accent); color: var(--accent); background: rgba(232,255,71,.08); }
.divider { height: 1px; background: var(--border); margin: 20px 0; }
.meaning-label {
  font-size: 10px; font-weight: 600; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--sub); margin-bottom: 8px;
}
.meaning-text {
  font-size: 28px; font-weight: 700;
  color: var(--text); line-height: 1.2; margin-bottom: 16px;
}
.syns-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
.syn-tag {
  padding: 4px 12px; border-radius: 20px;
  border: 1px solid var(--border); background: var(--surface);
  font-size: 12px; color: var(--sub);
}

/* â”€â”€ ì˜ˆë¬¸ ì„¹ì…˜ â”€â”€ */
.section {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 20px; padding: 22px 24px; margin-bottom: 12px;
}
.section-label {
  font-size: 10px; font-weight: 600; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--sub); margin-bottom: 16px;
}
.example-item {
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
}
.example-item:last-child { border-bottom: none; padding-bottom: 0; }
.example-item:first-child { padding-top: 0; }
.ex-num {
  font-size: 10px; font-weight: 700; color: var(--accent);
  letter-spacing: 1px; margin-bottom: 6px;
}
.ex-row {
  display: flex; align-items: flex-start; gap: 10px;
}
.ex-text { flex: 1; }
.ex-en {
  font-size: 15px; color: var(--text);
  line-height: 1.6; margin-bottom: 4px;
}
.ex-en b { color: var(--accent); font-weight: 700; }
.ex-ko { font-size: 13px; color: var(--sub); line-height: 1.5; }
.ex-speak-btn {
  flex-shrink: 0;
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--sub);
  font-size: 14px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all .15s;
  margin-top: 2px;
}
.ex-speak-btn:hover { border-color: var(--accent); color: var(--accent); }
.ex-speak-btn.playing { border-color: var(--accent); color: var(--accent); background: rgba(232,255,71,.08); }

/* â”€â”€ ë¡œë”© ìƒíƒœ â”€â”€ */
.loading-examples {
  display: flex; flex-direction: column; gap: 12px; padding: 8px 0;
}
.loading-bar {
  height: 14px; border-radius: 6px;
  background: linear-gradient(90deg, var(--border) 25%, #2a2a2a 50%, var(--border) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.4s infinite;
}
.loading-bar.short { width: 60%; }
.loading-bar.mid { width: 80%; }
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
.generating-label {
  font-size: 12px; color: var(--sub);
  display: flex; align-items: center; gap: 6px; margin-bottom: 12px;
}
.dot-pulse { display: inline-flex; gap: 3px; }
.dot-pulse span {
  width: 4px; height: 4px; border-radius: 50%;
  background: var(--accent); animation: pulse 1.2s infinite;
}
.dot-pulse span:nth-child(2) { animation-delay: .2s; }
.dot-pulse span:nth-child(3) { animation-delay: .4s; }
@keyframes pulse { 0%,80%,100%{opacity:.2} 40%{opacity:1} }

/* â”€â”€ í•˜ë‹¨ ë„¤ë¹„ â”€â”€ */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(10,10,10,.95);
  backdrop-filter: blur(12px);
  border-top: 1px solid var(--border);
  padding: 12px 20px;
  display: flex; gap: 10px;
}
.bottom-nav-btn {
  flex: 1; padding: 13px; border-radius: 12px;
  border: 1px solid var(--border); background: var(--surface);
  color: var(--text); font-family: 'DM Sans', sans-serif;
  font-size: 14px; font-weight: 500; cursor: pointer;
  transition: all .15s;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.bottom-nav-btn:hover { background: #222; border-color: #3a3a3a; }
.bottom-nav-btn.primary { background: var(--accent); color: #0a0a0a; border-color: var(--accent); font-weight: 700; }
.bottom-nav-btn.primary:hover { background: #d4eb3a; }
.bottom-nav-btn:disabled { opacity: .3; cursor: default; }

.error-wrap { text-align: center; padding: 80px 20px; color: var(--sub); }
.error-icon { font-size: 48px; margin-bottom: 16px; }
.error-text { font-size: 16px; margin-bottom: 20px; }
.error-link {
  display: inline-block; padding: 12px 24px; border-radius: 12px;
  background: var(--surface); border: 1px solid var(--border);
  color: var(--text); text-decoration: none; font-size: 14px;
}
</style>
</head>
<body>

<header>
  <a class="back-btn" href="index.html">â€¹ ëª©ë¡</a>
  <span class="brand">Hello Words</span>
  <div class="nav-btns">
    <button class="nav-btn" id="prevBtn" onclick="goWord(-1)">â€¹</button>
    <button class="nav-btn" id="nextBtn" onclick="goWord(1)">â€º</button>
  </div>
</header>

<div class="content" id="content">
  <div class="error-wrap"><div class="error-icon">â³</div><div class="error-text">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
</div>

<div class="bottom-nav" id="bottomNav" style="display:none">
  <button class="bottom-nav-btn" onclick="goWord(-1)" id="prevBtnBottom">â€¹ ì´ì „</button>
  <button class="bottom-nav-btn primary" onclick="speak(currentWord())">ğŸ”Š ë“£ê¸°</button>
  <button class="bottom-nav-btn" onclick="goWord(1)" id="nextBtnBottom">ë‹¤ìŒ â€º</button>
</div>

<script>
let allWords = {};
let wordKeys = [];
let currentKey = '';
let examplesCache = {};  // ë‹¨ì–´ë³„ ì˜ˆë¬¸ ìºì‹œ

const params = new URLSearchParams(location.search);
const targetWord = params.get('w') || '';

async function init() {
  try {
    const res = await fetch('words_data.json');
    allWords = await res.json();
    wordKeys = Object.keys(allWords).sort((a,b) => {
      const la = allWords[a].level, lb = allWords[b].level;
      if (la !== lb) return la.localeCompare(lb);
      return a.localeCompare(b);
    });
    currentKey = targetWord || wordKeys[0];
    if (!allWords[currentKey]) { showError(); return; }
    render();
  } catch(e) { showError(); }
}

function currentWord() {
  return allWords[currentKey]?.word || '';
}

function render() {
  const w = allWords[currentKey];
  if (!w) { showError(); return; }

  document.title = `${w.word} â€” Hello Words`;
  history.replaceState(null, '', `?w=${encodeURIComponent(currentKey)}`);

  const idx = wordKeys.indexOf(currentKey);
  document.getElementById('prevBtn').disabled = idx <= 0;
  document.getElementById('nextBtn').disabled = idx >= wordKeys.length - 1;
  document.getElementById('prevBtnBottom').disabled = idx <= 0;
  document.getElementById('nextBtnBottom').disabled = idx >= wordKeys.length - 1;

  const levelClass = `badge-${w.level}`;
  const levelText = { '600': '600ì ëŒ€', '700': '700ì ëŒ€', '800': '800ì ëŒ€' }[w.level] || w.level;
  const syns = (w.synonyms || []).map(s => `<span class="syn-tag">${s}</span>`).join('');

  document.getElementById('content').innerHTML = `
    <div class="level-badge ${levelClass}">${levelText} Â· ${idx + 1} / ${wordKeys.length}</div>

    <div class="word-card">
      <div class="word-main">${w.word}</div>
      <div class="phonetic">${w.phonetic || ''}</div>
      <button class="tts-btn" id="wordTtsBtn" onclick="speakWord()">
        ğŸ”Š ë°œìŒ ë“£ê¸°
      </button>
      <div class="divider"></div>
      <div class="meaning-label">ëœ»</div>
      <div class="meaning-text">${w.meaning}</div>
      ${syns ? `<div class="syns-wrap">${syns}</div>` : ''}
    </div>

    <div class="section">
      <div class="section-label">ì˜ˆë¬¸ 10ê°œ</div>
      <div id="examplesArea">
        <div class="generating-label">
          <div class="dot-pulse"><span></span><span></span><span></span></div>
          ì˜ˆë¬¸ ìƒì„± ì¤‘...
        </div>
        <div class="loading-examples">
          ${Array(5).fill(0).map(()=>`
            <div><div class="loading-bar mid" style="margin-bottom:6px"></div>
            <div class="loading-bar short"></div></div>
          `).join('')}
        </div>
      </div>
    </div>
  `;

  document.getElementById('bottomNav').style.display = 'flex';
  window.scrollTo(0, 0);

  // ì˜ˆë¬¸ ë¡œë“œ (ìºì‹œ ìˆìœ¼ë©´ ë°”ë¡œ, ì—†ìœ¼ë©´ API í˜¸ì¶œ)
  loadExamples(w);
}

async function loadExamples(w) {
  const key = w.word;

  // ìºì‹œ í™•ì¸
  if (examplesCache[key]) {
    renderExamples(examplesCache[key], w.word);
    return;
  }

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{
          role: 'user',
          content: `TOEIC ë‹¨ì–´ "${key}"(ëœ»: ${w.meaning})ì˜ ë¹„ì¦ˆë‹ˆìŠ¤/ì¼ìƒ ì˜ˆë¬¸ 10ê°œë¥¼ JSONìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜.
ê° ì˜ˆë¬¸ì€ ë‹¤ë¥¸ ìƒí™©, ë‹¤ë¥¸ ë¬¸ì¥ í˜•íƒœë¡œ. ë‹¨ì–´ì˜ ë‹¤ì–‘í•œ í˜•íƒœ(ing, ed, s ë“±)ë„ ì‚¬ìš©í•´.
ì‘ë‹µì€ JSON ë°°ì—´ë§Œ, ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´:
[{"en":"ë¬¸ì¥","ko":"í•œêµ­ì–´ ë²ˆì—­"},...]`
        }]
      })
    });
    const data = await res.json();
    const text = data.content?.[0]?.text || '';
    const start = text.indexOf('[');
    const end = text.lastIndexOf(']') + 1;
    const examples = JSON.parse(text.slice(start, end));

    examplesCache[key] = examples;
    renderExamples(examples, key);
  } catch(e) {
    // API ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ì˜ˆë¬¸ 1ê°œë¼ë„ í‘œì‹œ
    const fallback = [{ en: w.example_en, ko: w.example_ko }];
    renderExamples(fallback, key);
  }
}

function renderExamples(examples, word) {
  const area = document.getElementById('examplesArea');
  if (!area) return;

  function hl(text) {
    if (!text || !word) return text || '';
    const base = word.split('-').join(' ');
    return text.replace(
      new RegExp(`\\b(${base.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}(?:s|ed|ing|ly|tion|ness|ment)?)\\b`, 'gi'),
      '<b>$1</b>'
    );
  }

  area.innerHTML = examples.map((ex, i) => `
    <div class="example-item">
      <div class="ex-num">EX ${i + 1}</div>
      <div class="ex-row">
        <div class="ex-text">
          <div class="ex-en">${hl(ex.en)}</div>
          <div class="ex-ko">${ex.ko}</div>
        </div>
        <button class="ex-speak-btn" onclick="speakSentence(this, '${ex.en.replace(/'/g,"\\'").replace(/"/g,'&quot;')}')" title="ë“£ê¸°">
          ğŸ”Š
        </button>
      </div>
    </div>
  `).join('');
}

// ë‹¨ì–´ ë°œìŒ
function speakWord() {
  const w = allWords[currentKey];
  if (!w) return;
  const btn = document.getElementById('wordTtsBtn');
  speakText(w.word, btn);
}

// ì˜ˆë¬¸ ë°œìŒ
function speakSentence(btn, text) {
  // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ë²„íŠ¼ ë¦¬ì…‹
  document.querySelectorAll('.ex-speak-btn.playing').forEach(b => {
    b.classList.remove('playing');
    b.textContent = 'ğŸ”Š';
  });
  speakText(text, btn);
}

function speakText(text, btn) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();

  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US'; u.rate = 0.85;

  if (btn) {
    btn.classList.add('playing');
    btn.textContent = 'â¸';
  }
  u.onend = u.onerror = () => {
    if (btn) {
      btn.classList.remove('playing');
      btn.textContent = 'ğŸ”Š';
    }
  };
  window.speechSynthesis.speak(u);
}

function goWord(dir) {
  const idx = wordKeys.indexOf(currentKey);
  const next = idx + dir;
  if (next >= 0 && next < wordKeys.length) {
    currentKey = wordKeys[next];
    render();
  }
}

function showError() {
  document.getElementById('content').innerHTML = `
    <div class="error-wrap">
      <div class="error-icon">ğŸ˜•</div>
      <div class="error-text">ë‹¨ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”</div>
      <a class="error-link" href="index.html">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>`;
}

init();
</script>
</body>
</html>
