<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#0a0a0a">
<title>Hello Words</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0a;
  --surface: #141414;
  --border: #252525;
  --accent: #e8ff47;
  --text: #f0f0e8;
  --sub: #666660;
  --card: #1a1a1a;
  --c600: #4CAF7D;
  --c700: #4A9EFF;
  --c800: #FF7043;
}
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; min-height: 100vh; }

/* â”€â”€ í—¤ë” â”€â”€ */
header {
  position: sticky; top: 0; z-index: 50;
  background: rgba(10,10,10,.92);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 14px 20px;
  display: flex; align-items: center; gap: 14px;
}
.back-btn {
  display: flex; align-items: center; gap: 6px;
  color: var(--sub);
  font-size: 14px;
  cursor: pointer;
  text-decoration: none;
  transition: color .2s;
  flex-shrink: 0;
}
.back-btn:hover { color: var(--text); }
.brand {
  font-family: 'Instrument Serif', serif;
  font-style: italic;
  font-size: 20px;
  color: var(--accent);
}
.nav-btns {
  margin-left: auto;
  display: flex; gap: 8px;
}
.nav-btn {
  width: 34px; height: 34px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  font-size: 16px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all .15s;
  text-decoration: none;
}
.nav-btn:hover { border-color: #3a3a3a; background: #222; }
.nav-btn:disabled { opacity: .3; cursor: default; }

/* â”€â”€ ë©”ì¸ ì½˜í…ì¸  â”€â”€ */
.content { padding: 24px 20px 60px; max-width: 600px; margin: 0 auto; }

/* â”€â”€ ë ˆë²¨ ë±ƒì§€ â”€â”€ */
.level-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: .5px;
  margin-bottom: 16px;
}
.badge-600 { background: rgba(76,175,125,.15); color: var(--c600); border: 1px solid rgba(76,175,125,.3); }
.badge-700 { background: rgba(74,158,255,.15); color: var(--c700); border: 1px solid rgba(74,158,255,.3); }
.badge-800 { background: rgba(255,112,67,.15); color: var(--c800); border: 1px solid rgba(255,112,67,.3); }

/* â”€â”€ ë‹¨ì–´ ì¹´ë“œ â”€â”€ */
.word-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 28px 24px;
  margin-bottom: 16px;
}
.word-main {
  font-family: 'Instrument Serif', serif;
  font-size: 48px;
  line-height: 1;
  color: var(--text);
  margin-bottom: 6px;
  letter-spacing: -1px;
}
.phonetic {
  font-size: 14px;
  color: var(--sub);
  font-family: monospace;
  margin-bottom: 20px;
}
.tts-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 16px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--sub);
  font-size: 13px;
  cursor: pointer;
  transition: all .2s;
  margin-bottom: 20px;
}
.tts-btn:hover { border-color: var(--accent); color: var(--accent); }
.tts-btn.playing { border-color: var(--accent); color: var(--accent); background: rgba(232,255,71,.08); }
.divider { height: 1px; background: var(--border); margin: 20px 0; }
.meaning-label {
  font-size: 10px; font-weight: 600; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--sub); margin-bottom: 8px;
}
.meaning-text {
  font-size: 28px; font-weight: 700;
  color: var(--text); line-height: 1.2;
  margin-bottom: 16px;
}
.syns-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
.syn-tag {
  padding: 4px 12px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: var(--surface);
  font-size: 12px;
  color: var(--sub);
}

/* â”€â”€ ì˜ˆë¬¸ ì„¹ì…˜ â”€â”€ */
.section {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 22px 24px;
  margin-bottom: 12px;
}
.section-label {
  font-size: 10px; font-weight: 600; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--sub); margin-bottom: 14px;
}
.example-item { margin-bottom: 16px; }
.example-item:last-child { margin-bottom: 0; }
.ex-situation {
  font-size: 11px;
  color: var(--sub);
  margin-bottom: 5px;
  padding: 3px 10px;
  background: rgba(255,255,255,.04);
  border-radius: 6px;
  display: inline-block;
}
.ex-en {
  font-size: 16px;
  color: var(--text);
  line-height: 1.55;
  margin-bottom: 4px;
}
.ex-en b { color: var(--accent); font-weight: 700; }
.ex-ko {
  font-size: 13px;
  color: var(--sub);
  line-height: 1.5;
}

/* â”€â”€ ë„¤ë¹„ê²Œì´ì…˜ â”€â”€ */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(10,10,10,.95);
  backdrop-filter: blur(12px);
  border-top: 1px solid var(--border);
  padding: 12px 20px;
  display: flex; gap: 10px;
}
.bottom-nav-btn {
  flex: 1;
  padding: 13px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all .15s;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.bottom-nav-btn:hover { background: #222; border-color: #3a3a3a; }
.bottom-nav-btn.primary { background: var(--accent); color: #0a0a0a; border-color: var(--accent); font-weight: 700; }
.bottom-nav-btn.primary:hover { background: #d4eb3a; }
.bottom-nav-btn:disabled { opacity: .3; cursor: default; }

/* â”€â”€ ì—ëŸ¬ â”€â”€ */
.error-wrap {
  text-align: center; padding: 80px 20px;
  color: var(--sub);
}
.error-icon { font-size: 48px; margin-bottom: 16px; }
.error-text { font-size: 16px; margin-bottom: 20px; }
.error-link {
  display: inline-block;
  padding: 12px 24px;
  border-radius: 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text);
  text-decoration: none;
  font-size: 14px;
}
</style>
</head>
<body>

<header>
  <a class="back-btn" href="index.html">â€¹ ëª©ë¡</a>
  <span class="brand">Hello Words</span>
  <div class="nav-btns">
    <button class="nav-btn" id="prevBtn" onclick="goWord(-1)" title="ì´ì „ ë‹¨ì–´">â€¹</button>
    <button class="nav-btn" id="nextBtn" onclick="goWord(1)" title="ë‹¤ìŒ ë‹¨ì–´">â€º</button>
  </div>
</header>

<div class="content" id="content">
  <div class="error-wrap">
    <div class="error-icon">â³</div>
    <div class="error-text">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>
</div>

<div class="bottom-nav" id="bottomNav" style="display:none">
  <button class="bottom-nav-btn" onclick="goWord(-1)" id="prevBtnBottom">â€¹ ì´ì „</button>
  <button class="bottom-nav-btn primary" onclick="toggleSpeak()" id="speakBtn">ğŸ”Š ë“£ê¸°</button>
  <button class="bottom-nav-btn" onclick="goWord(1)" id="nextBtnBottom">ë‹¤ìŒ â€º</button>
</div>

<script>
let allWords = {};
let wordKeys = [];
let currentKey = '';
let speaking = false;

const params = new URLSearchParams(location.search);
const targetWord = params.get('w') || '';

async function init() {
  try {
    const res = await fetch('words_data.json');
    allWords = await res.json();
    wordKeys = Object.keys(allWords).sort((a,b) => {
      const la = allWords[a].level, lb = allWords[b].level;
      if (la !== lb) return la.localeCompare(lb);
      return a.localeCompare(b);
    });

    currentKey = targetWord || wordKeys[0];
    if (!allWords[currentKey]) {
      showError();
      return;
    }
    render();
  } catch(e) {
    showError();
  }
}

function render() {
  const w = allWords[currentKey];
  if (!w) { showError(); return; }

  // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
  document.title = `${w.word} â€” Hello Words`;

  // URL ì—…ë°ì´íŠ¸
  history.replaceState(null, '', `?w=${encodeURIComponent(currentKey)}`);

  // ì¸ë±ìŠ¤
  const idx = wordKeys.indexOf(currentKey);
  document.getElementById('prevBtn').disabled = idx <= 0;
  document.getElementById('nextBtn').disabled = idx >= wordKeys.length - 1;
  document.getElementById('prevBtnBottom').disabled = idx <= 0;
  document.getElementById('nextBtnBottom').disabled = idx >= wordKeys.length - 1;

  // ë ˆë²¨ ìƒ‰ìƒ
  const levelClass = `badge-${w.level}`;
  const levelText = { '600': '600ì ëŒ€', '700': '700ì ëŒ€', '800': '800ì ëŒ€' }[w.level] || w.level;

  // ë™ì˜ì–´
  const syns = (w.synonyms || []).map(s => `<span class="syn-tag">${s}</span>`).join('');

  // ì˜ˆë¬¸ í•˜ì´ë¼ì´íŠ¸
  function hl(text, word) {
    if (!text || !word) return text || '';
    const base = word.split('-').join(' ');
    return text.replace(new RegExp(`\\b(${base.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}(?:s|ed|ing|ly|tion|ness|ment)?)\\b`, 'gi'), '<b>$1</b>');
  }

  const exHl = hl(w.example_en, w.word);
  const sitSpan = w.situation ? `<div class="ex-situation">${w.situation}</div>` : '';

  document.getElementById('content').innerHTML = `
    <div class="level-badge ${levelClass}">${levelText} Â· ${idx + 1} / ${wordKeys.length}</div>

    <div class="word-card">
      <div class="word-main">${w.word}</div>
      <div class="phonetic">${w.phonetic || ''}</div>
      <button class="tts-btn" onclick="speak('${w.word.replace(/'/g,"\\'")}')">
        ğŸ”Š <span id="ttsLabel">ë°œìŒ ë“£ê¸°</span>
      </button>
      <div class="divider"></div>
      <div class="meaning-label">ëœ»</div>
      <div class="meaning-text">${w.meaning}</div>
      ${syns ? `<div class="syns-wrap">${syns}</div>` : ''}
    </div>

    <div class="section">
      <div class="section-label">ì˜ˆë¬¸</div>
      <div class="example-item">
        ${sitSpan}
        <div class="ex-en">${exHl}</div>
        <div class="ex-ko">${w.example_ko || ''}</div>
      </div>
    </div>
  `;

  document.getElementById('bottomNav').style.display = 'flex';
  window.scrollTo(0, 0);
}

function goWord(dir) {
  const idx = wordKeys.indexOf(currentKey);
  const next = idx + dir;
  if (next >= 0 && next < wordKeys.length) {
    currentKey = wordKeys[next];
    render();
  }
}

function speak(word) {
  if (window.speechSynthesis) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(word);
    u.lang = 'en-US'; u.rate = 0.9;
    const btn = document.querySelector('.tts-btn');
    const label = document.getElementById('ttsLabel');
    if (btn) btn.classList.add('playing');
    if (label) label.textContent = 'ì¬ìƒ ì¤‘...';
    u.onend = () => {
      if (btn) btn.classList.remove('playing');
      if (label) label.textContent = 'ë°œìŒ ë“£ê¸°';
    };
    window.speechSynthesis.speak(u);
  }
}

function toggleSpeak() {
  const w = allWords[currentKey];
  if (w) speak(w.word);
}

function showError() {
  document.getElementById('content').innerHTML = `
    <div class="error-wrap">
      <div class="error-icon">ğŸ˜•</div>
      <div class="error-text">ë‹¨ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”</div>
      <a class="error-link" href="index.html">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>`;
}

init();
</script>
</body>
</html>
